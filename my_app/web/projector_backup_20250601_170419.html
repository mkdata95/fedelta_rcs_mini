<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>프로젝터 관리 - RCS 컨트롤 시스템</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <!-- 폰트어썸 아이콘 프리로드 -->
  <link rel="preload" href="assets/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="assets/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
  <!-- 로컬 CSS 파일 -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/fontawesome.min.css">
  <link rel="stylesheet" href="assets/css/adminlte.min.css">
  <link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="assets/css/icons.css">
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="assets/css/components.css">
  <link rel="stylesheet" href="assets/css/pc.css">
  <!-- jQuery 및 JavaScript 파일 -->
  <script src="assets/js/jquery-3.6.0.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/common.js"></script>
  <!-- 자바스크립트 파일 -->
  <script>
    // 웹뷰 메시지 완전히 제거하기 위한 즉시 실행 스크립트
    (function() {
      // 웹뷰 상단 메시지 제거를 위한 스타일 즉시 적용
      var style = document.createElement('style');
      style.textContent = `
        /* 웹뷰 헤더 강제 제거 */
        body::before, 
        body::after, 
        body > *:not(.wrapper):not(script):not(style):not(.js-modal):not(.js-notification):not(.modal):not(.modal-backdrop),
        body > div:not(.wrapper):not(.js-modal):not(.js-notification):not(.modal):not(.modal-backdrop),
        #app-header, .app-header, #status-bar, .status-bar, #title-bar, .title-bar,
        #server-status, .server-status,
        div[style*="position: fixed"][style*="top: 0"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="position:fixed"][style*="top:0"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="background-color"][style*="fixed"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="z-index: 9"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="z-index:9"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop) {
          display: none !important;
          height: 0 !important;
          visibility: hidden !important;
          opacity: 0 !important;
          position: absolute !important;
          z-index: -9999 !important;
        }
        
        /* 문서와 콘텐츠 상단 여백 제거 */
        html, body, .wrapper {
          margin-top: 0 !important;
          padding-top: 0 !important;
        }
        
        /* 모달은 제외할 수 있도록 추가 */
       
      `;
      document.head.appendChild(style);
      
      // DOM 변경 감지하여 웹뷰 요소 제거
      var observer = new MutationObserver(function(mutations) {
        const selectors = [
          '.webview-message', '.webview-title', '.webview-status', '.server-status',
          '.status-bar', '.app-title-bar', '.app-header-original', '[id*="title-container"]',
          '[class*="title-container"]', '[id*="server-status"]', '[class*="server-status"]',
          '[id*="app-header"]', '[class*="app-header"]', '.offline-remote-header',
          '#offline-remote-header', '.server-status-container', '#server-status-container'
        ];
        
        selectors.forEach(selector => {
          document.querySelectorAll(selector).forEach(el => {
            if(el && el.parentNode) {
              el.parentNode.removeChild(el);
            }
          });
        });
      });
      
      // document.body가 존재할 때만 observer 시작
      if (document.body) {
        observer.observe(document.body, { childList: true, subtree: true });
        // 3초 동안만 감시
        setTimeout(() => observer.disconnect(), 3000);
      }
    })();

    // 문서 로드 시 타이틀 강제 변경
    document.addEventListener('DOMContentLoaded', function() {
        document.title = "프로젝터 관리 - RCS 컨트롤 시스템";
    });

    // 웹뷰 상단 헤더 숨기기 함수
    function hideWebViewHeader() {
      try {
        // Android WebView
        if (window.AndroidChannel) {
          window.AndroidChannel.postMessage('hideHeader:true');
          window.AndroidChannel.postMessage('hideStatusBar:true');
          // window.AndroidChannel.postMessage('fullscreen:true'); // alert 모달 표시 방해로 인해 제거
        }
        
        // iOS WKWebView
        if (window.webkit && window.webkit.messageHandlers) {
          window.webkit.messageHandlers.hideHeader?.postMessage(true);
          window.webkit.messageHandlers.hideStatusBar?.postMessage(true);
          // window.webkit.messageHandlers.fullscreen?.postMessage(true); // alert 모달 표시 방해로 인해 제거
        }
      } catch (e) {
        console.warn('웹뷰 헤더 숨기기 실패:', e);
      }
    }
  </script>
  <style>
    /* 활성 버튼 커스텀 스타일 - 밝은 녹색(켜짐) / 밝은 빨간색(꺼짐) */
    .custom-switch .custom-control-input:checked ~ .custom-control-label::before {
      background-color: #28a745 !important; /* 밝은 녹색 */
      border-color: #28a745 !important;
    }
    
    .custom-switch .custom-control-input:not(:checked) ~ .custom-control-label::before {
      background-color: #dc3545 !important; /* 밝은 빨간색 */
      border-color: #dc3545 !important;
    }
    
    .custom-switch .custom-control-input:checked ~ .custom-control-label::after {
      background-color: #fff !important;
      transform: translateX(0.75rem) !important;
    }
    
    .custom-switch .custom-control-input:not(:checked) ~ .custom-control-label::after {
      background-color: #fff !important;
      transform: translateX(0) !important;
    }
    
    .custom-switch .custom-control-input:focus ~ .custom-control-label::before {
      box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
    }
    
    .custom-switch .custom-control-input:not(:checked):focus ~ .custom-control-label::before {
      box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }

    /* 카드, 스케줄 카드, 목록 카드 어두운 배경 및 통일 스타일 */
    .card,
    .schedule-card,
    .pc-list-card {
      background: #191c24 !important;
      border: none !important;
      border-radius: 5px !important;
      box-shadow: 0 0 10px rgba(0,0,0,0.2) !important;
      color: #e9ecef !important;
    }
    .card-header, .schedule-card .card-header, .pc-list-card .card-header {
      background: #191c24 !important;
      border-bottom: 1px solid #2c2e33 !important;
      color: #e9ecef !important;
    }
    .card-title {
      color: #e9ecef !important;
    }
    .card table thead th,
    .pc-list-card table thead th {
      background: #191c24 !important;
      color: #e9ecef !important;
      border-color: #2c2e33 !important;
    }
    /* 동그란 요일 선택 스타일 강제 적용 */
    .weekday-selector {
      display: flex;
      gap: 8px;
      margin-top: 5px;
    }
    .weekday-selector label {
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .weekday-selector input[type="checkbox"] {
      display: none;
    }
    .circle-day {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #2A3038;
      border: 2px solid #2c2e33;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
      color: #e9ecef;
      transition: all 0.2s ease;
    }
    .weekday-selector input[type="checkbox"]:checked + .circle-day {
      background: #1976d2;
      color: #fff;
      border: 2px solid #1976d2;
      box-shadow: 0 0 10px rgba(25, 118, 210, 0.3);
    }
    .weekday-selector label:hover .circle-day {
      border: 2px solid #1976d2;
      transform: scale(1.05);
    }
    .weekday-selector input[type="checkbox"]:checked + .circle-day:hover {
      background: #1565c0;
    }
    
    /* 모달 스타일 완전 재정의 */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 9999;
      padding: 20px;
      box-sizing: border-box;
    }
    
    .modal.show {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    .modal-dialog {
      margin: 30px auto;
      max-width: 500px;
      position: relative;
    }
    
    .modal-content {
      background-color: #191c24;
      color: #e9ecef;
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      position: relative;
    }
    
    .modal-header {
      padding: 15px;
      background-color: #0d6efd;
      color: white;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 500;
    }
    
    .close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      opacity: 0.8;
    }
    
    .close:hover {
      opacity: 1;
    }
    
    .modal-body {
      padding: 15px;
    }
    
    .modal-footer {
      padding: 15px;
      border-top: 1px solid #2c2e33;
      display: flex;
      justify-content: flex-end;
    }
    
    .modal-backdrop {
      display: none !important;
    }
    
    /* 로딩 스피너 스타일 */
    .loading-spinner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10000;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 토스트 메시지 스타일 */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .toast-message {
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: 4px;
      color: white;
      opacity: 1;
      transition: opacity 0.5s ease-in-out;
    }

    .toast-message.hiding {
      opacity: 0;
    }

    .toast-success {
      background-color: #28a745;
    }

    .toast-error {
      background-color: #dc3545;
    }

    .toast-info {
      background-color: #17a2b8;
    }

    .toast-warning {
      background-color: #ffc107;
      color: #000;
    }

    /* 상태 배지 스타일 */
    .badge {
      padding: 5px 10px;
      border-radius: 12px;
      font-weight: normal;
      margin: 6px 12px;
      display: inline-block;
      vertical-align: middle;
    }

    .badge-online {
      background-color: #28a745;
      color: white;
    }

    .badge-offline {
      background-color: #dc3545;
      color: white;
    }

    .badge-warning {
      background-color: #ffc107;
      color: black;
    }

    /* 버튼 그룹 스타일 */
    .control-buttons, .settings-buttons {
      display: flex;
      gap: 5px;
      justify-content: center;
      align-items: center;
    }

    .control-btn {
      padding: 4px 8px;
      font-size: 0.875rem;
    }

    /* 모달 스타일 개선 */
    .modal-content {
      background-color: #191c24;
      color: #e9ecef;
    }

    .modal-header {
      border-bottom: 1px solid #2c2e33;
    }

    .modal-footer {
      border-top: 1px solid #2c2e33;
    }

    .form-control {
      background-color: #2A3038;
      border: 1px solid #2c2e33;
      color: #e9ecef;
    }

    .form-control:focus {
      background-color: #2A3038;
      border-color: #0090e7;
      color: #e9ecef;
    }

    .close {
      color: #e9ecef;
    }

    .close:hover {
      color: #ffffff;
    }

    /* 배지 스타일 강화 */
    #projectorTable td .badge {
      display: inline-block !important;
      padding: 8px 16px !important;
      margin: 4px 8px !important;
      min-width: 70px !important;
      text-align: center !important;
      vertical-align: middle !important;
      border-radius: 4px !important;
      font-size: 14px !important;
      font-weight: 500 !important;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
    }

    /* 상태 배지 색상 */
    #projectorTable td .badge-online {
      background-color: #00d25b !important;
      color: #fff !important;
      border: 2px solid #00b050 !important;
    }

    #projectorTable td .badge-offline {
      background-color: #fc424a !important;
      color: #fff !important;
      border: 2px solid #e63740 !important;
    }

    #projectorTable td .badge-warning {
      background-color: #ffab00 !important;
      color: #000 !important;
      border: 2px solid #f59e00 !important;
    }

    /* 테이블 셀 여백 강화 */
    #projectorTable td {
      padding: 12px 20px !important;
      vertical-align: middle !important;
      height: 60px !important;
      text-align: center !important;
    }

    /* NET상태와 상태 열 스타일 */
    #projectorTable th:nth-child(4),
    #projectorTable th:nth-child(5),
    #projectorTable td:nth-child(4),
    #projectorTable td:nth-child(5) {
      min-width: 120px !important;
      width: 120px !important;
      padding: 8px 4px !important;
      text-align: center !important;
    }

    /* 배지 컨테이너 스타일 */
    #projectorTable td .badge-container {
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      height: 100% !important;
      padding: 4px 0 !important;
    }

    /* NET상태 밝은 녹색 톤 */
    .text-success {
      color: #00ff88 !important;
    }

    .text-danger {
      color: #ff4757 !important;
    }

    .text-warning {
      color: #ffa502 !important;
    }

    /* 네비게이션 바 시간 표시 스타일 */
    #current-time {
      background: none !important;
      border: none !important;
      box-shadow: none !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    /* 도움말 텍스트 스타일 개선 */
    .form-text.text-muted {
      font-size: 0.85rem;
      color: #adb5bd !important;
      margin-top: 5px;
      line-height: 1.4;
    }

    .form-text.text-muted i {
      color: #6c757d;
    }

    .form-text.text-muted strong {
      color: #e9ecef;
    }

    /* 알림 박스 스타일 개선 */
    .alert-info {
      background-color: rgba(23, 162, 184, 0.15) !important;
      border: 1px solid rgba(23, 162, 184, 0.3) !important;
      color: #b8daff !important;
    }

    .alert-info h6 {
      color: #17a2b8 !important;
      margin-bottom: 10px;
    }

    .alert-info ul li {
      margin-bottom: 5px;
    }

    .alert-info ul li strong {
      color: #fff !important;
    }

    /* placeholder 텍스트 스타일 */
    .form-control::placeholder {
      color: #6c757d !important;
      opacity: 0.8;
    }

  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
  <div class="wrapper">
    <!-- 네비게이션 바 -->
    <nav class="main-header navbar navbar-expand navbar-dark" style="background-color: #191c24 !important; border-bottom: 1px solid #2c2e33;">
      <!-- 좌측 네비게이션 링크 -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <span class="nav-link font-weight-bold">SMART RCS</span>
        </li>
      </ul>

      <!-- 우측 네비게이션 링크 -->
      <ul class="navbar-nav ml-auto">
        <div id="current-time" class="mr-3 mt-2 text-white"></div>
      </ul>
    </nav>
    <!-- /.navbar -->

    <!-- 메인 사이드바 -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4" style="background-color: #191c24; box-shadow: 0 0 10px rgba(0,0,0,0.2);">
      <!-- 브랜드 로고 -->
      <a href="index.html" class="brand-link" style="background-color: #191c24; border-bottom: 1px solid #2c2e33;">
        <span class="brand-text font-weight-bold ml-3" style="color: #e9ecef;">RCS CONTROL</span>
      </a>

      <!-- 사이드바 -->
      <div class="sidebar" style="background-color: #191c24;">
        <!-- 사이드바 메뉴 -->
      <nav class="mt-3">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-item mb-2">
              <a href="javascript:void(0);" onclick="navigateToPage('dashboard.html')" class="nav-link" id="dashboard-link">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <p>
                  대시보드
                </p>
              </a>
            </li>
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('projector.html')" class="nav-link active" id="projector-link">
                <i class="nav-icon fas fa-projector"></i>
                <p>
                빔프로젝터관리
                </p>
              </a>
            </li>
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('pc.html')" class="nav-link" id="pc-link">
                <i class="nav-icon fas fa-desktop"></i>
                <p>
                  PC관리
                </p>
              </a>
            </li>
                    <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('pdu.html')" class="nav-link" id="pdu-link">
              <i class="nav-icon fas fa-plug"></i>
              <p>
                PDU관리
              </p>
            </a>
          </li>
          <!-- 그룹원격제어 메뉴 숨김 -->
          <!--
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('group-control.html')" class="nav-link" id="group-control-link">
              <i class="nav-icon fas fa-users"></i>
              <p>
                그룹원격제어
              </p>
            </a>
          </li>
          -->
          <!-- 설정 메뉴 숨김 -->
          <!--
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('settings.html')" class="nav-link" id="settings-link">
              <i class="nav-icon fas fa-cog"></i>
              <p>
                설정
              </p>
            </a>
          </li>
          -->
          </ul>
        </nav>
      </div>
    </aside>

  <!-- 메인 콘텐츠 -->
    <div class="content-wrapper" style="background-color: #0c1427; padding-top: 70px; margin-left: 260px; overflow-x: hidden;">
      <!-- 콘텐츠 헤더 (페이지 헤더) -->
    <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
            <h1 class="m-0">빔프로젝터 관리</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="dashboard.html">홈</a></li>
                <li class="breadcrumb-item active">빔프로젝터 관리</li>
              </ol>
            </div>
          </div>
        </div>
      </div>

      <section class="content">
        <div class="container-fluid">
          <!-- 프로젝터 알람 스케줄 설정 패널 -->
          <div class="card schedule-card">
            <div class="card-header">
              <h4 class="card-title mb-0">
              <i class="fas fa-clock mr-2" style="color: #0090e7;"></i>스케줄 관리
              </h4>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-3">
                  <div class="form-group mb-0">
                  <label class="small" style="color: #e9ecef;"><i class="fas fa-play text-success mr-1"></i>켜기 시간</label>
                  <input type="time" class="form-control form-control-sm schedule-time-input" id="start-time" value="08:00" style="background-color: #2A3038; border: 1px solid #2c2e33; color: #e9ecef;">
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group mb-0">
                  <label class="small" style="color: #e9ecef;"><i class="fas fa-stop text-danger mr-1"></i>끄기 시간</label>
                  <input type="time" class="form-control form-control-sm schedule-time-input" id="end-time" value="18:00" style="background-color: #2A3038; border: 1px solid #2c2e33; color: #e9ecef;">
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group mb-0">
                    <label class="small" style="color: #e9ecef;"><i class="fas fa-calendar-alt text-primary mr-1"></i>요일</label>
                    <div class="weekday-selector">
                      <label>
                        <input type="checkbox" class="day-checkbox" value="1" checked>
                        <span class="circle-day">월</span>
                      </label>
                      <label>
                        <input type="checkbox" class="day-checkbox" value="2" checked>
                        <span class="circle-day">화</span>
                      </label>
                      <label>
                        <input type="checkbox" class="day-checkbox" value="3" checked>
                        <span class="circle-day">수</span>
                      </label>
                      <label>
                        <input type="checkbox" class="day-checkbox" value="4" checked>
                        <span class="circle-day">목</span>
                      </label>
                      <label>
                        <input type="checkbox" class="day-checkbox" value="5" checked>
                        <span class="circle-day">금</span>
                      </label>
                      <label>
                        <input type="checkbox" class="day-checkbox" value="6">
                        <span class="circle-day">토</span>
                      </label>
                      <label>
                        <input type="checkbox" class="day-checkbox" value="0">
                        <span class="circle-day">일</span>
                      </label>
                      </div>
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group mb-0">
                  <label class="small invisible" style="color: #e9ecef;">적용</label>
                    <div class="d-flex flex-column">
                    <button type="button" class="btn btn-success btn-sm" id="save-schedule-btn" onclick="saveSchedule()">
                        <i class="fas fa-check mr-1"></i> 적용
                      </button>
                      <div class="custom-control custom-switch mt-2">
                      <input type="checkbox" class="custom-control-input" id="schedule-active">
                      <label class="custom-control-label" for="schedule-active" style="color: #e9ecef;">활성</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 구분선 -->
          <div class="section-divider">
            <h5 style="color: #000000; text-align: center;">빔프로젝터 관리</h5>
          </div>

          <!-- 프로젝터 목록 -->
          <div class="card projector-list-card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                <i class="fas fa-video mr-2"></i>
                <h4 class="card-title mb-0">빔프로젝터 목록</h4>
              </div>
              <div>
                <button class="btn btn-primary btn-add-projector" style="position: relative; z-index: 1;">
                  <i class="fas fa-plus"></i>
                  빔프로젝터 추가
                </button>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover m-0" id="projectorTable">
                  <thead>
                    <tr>
                    <th style="text-align: center;">NO.</th>
                      <th style="text-align: center;">이름</th>
                    <th style="text-align: center;">IP 주소</th>
                      <th style="text-align: center;">NET상태</th>
                      <th style="text-align: center;">상태</th>
                      <th style="text-align: center;">제어</th>
                    <th style="text-align: center;">설정</th>
                    </tr>
                  </thead>
                  <tbody id="projector-list">
                    <!-- 프로젝터 목록이 여기에 동적으로 추가됩니다 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div><!-- /.container-fluid -->
      </section>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer d-flex justify-content-between align-items-center" style="background-color: #191c24; border-top: 1px solid #2c2e33; color: #6c757d;">
      <div>
        <strong>Copyright © 2025 <a href="#" style="color: #0090e7;">FEDELTA SMART RCS</a>.</strong> All rights reserved.
      </div>
      <div class="d-flex align-items-center">
        <span class="mr-4" title="서버 상태">
          <span class="status-indicator online" id="server-status-indicator"></span>
          <span class="server-status-text">서버 정상</span>
        </span>
        <span title="네트워크 상태">
          <span class="status-indicator online" id="network-status-indicator"></span>
          <span class="network-status-text">네트워크 정상</span>
        </span>
      </div>
    </footer>
  </div>
  <!-- ./wrapper -->

<!-- 로딩 스피너 -->
<div id="pcSpinner" class="loading-spinner">
  <div class="spinner"></div>
  <p>로딩 중...</p>
</div>

<!-- 프로젝터 추가 모달 -->
<div class="modal fade" id="addProjectorModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">프로젝터 추가</h5>
        <button type="button" class="close" onclick="closeAddProjectorModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="addProjectorForm">
          <div class="form-group">
            <label for="projectorName">이름 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="projectorName" required placeholder="예: 회의실1 프로젝터, 강당 빔프로젝터">
            <small class="form-text text-muted">
              <i class="fas fa-info-circle mr-1"></i>구분하기 쉬운 이름을 입력하세요 (장소나 용도 포함 권장)
            </small>
          </div>
          <div class="form-group">
            <label for="projectorIp">IP 주소 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="projectorIp" required pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" placeholder="예: 192.168.1.100">
            <small class="form-text text-muted">
              <i class="fas fa-network-wired mr-1"></i>프로젝터의 네트워크 IP 주소를 입력하세요
            </small>
          </div>
          <div class="form-group">
            <label for="projectorModel">모델</label>
            <select class="form-control" id="projectorModel">
              <option value="PJLINK">PJLink 표준 (권장)</option>
              <option value="EPSON">Epson</option>
              <option value="PANASONIC">Panasonic</option>
              <option value="SONY">Sony</option>
              <option value="NEC">NEC</option>
              <option value="BENQ">BenQ</option>
              <option value="OPTOMA">Optoma</option>
              <option value="CANON">Canon</option>
              <option value="LG">LG</option>
              <option value="SAMSUNG">Samsung</option>
              <option value="EFUN">EFUN</option>
              <option value="OTHER">기타</option>
            </select>
            <small class="form-text text-muted">
              <i class="fas fa-star mr-1"></i><strong>권장:</strong> "PJLink 표준"은 모든 주요 제조사에서 동일하게 작동합니다
            </small>
          </div>
          <div class="form-group">
            <label for="projectorUsername">사용자 ID</label>
            <input type="text" class="form-control" id="projectorUsername" value="admin" placeholder="기본값: admin">
            <small class="form-text text-muted">
              <i class="fas fa-user mr-1"></i>대부분의 프로젝터는 기본값 "admin"을 사용합니다
            </small>
          </div>
          <div class="form-group">
            <label for="projectorPassword">비밀번호</label>
            <input type="password" class="form-control" id="projectorPassword" placeholder="비밀번호가 설정되어 있는 경우에만 입력">
            <small class="form-text text-muted">
              <i class="fas fa-lock mr-1"></i><strong>선택사항:</strong> 프로젝터에 PJLink 비밀번호가 설정된 경우에만 입력
              <br><i class="fas fa-question-circle mr-1"></i>비밀번호가 없으면 빈 칸으로 두세요
            </small>
          </div>
          
          <!-- 도움말 섹션 추가 -->
          <div class="alert alert-info mt-3">
            <h6><i class="fas fa-question-circle mr-2"></i>프로젝터 연결이 안 될 때</h6>
            <ul class="mb-0 small">
              <li><strong>네트워크 확인:</strong> 프로젝터와 서버가 같은 네트워크에 연결되어 있는지 확인</li>
              <li><strong>PJLink 활성화:</strong> 프로젝터 설정에서 PJLink 기능이 켜져 있는지 확인</li>
              <li><strong>포트 확인:</strong> 일반적으로 PJLink는 4352 포트를 사용합니다</li>
              <li><strong>방화벽:</strong> 네트워크 방화벽에서 해당 포트가 차단되지 않았는지 확인</li>
            </ul>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAddProjectorModal()">취소</button>
        <button type="button" class="btn btn-primary" onclick="addProjector()">추가</button>
      </div>
    </div>
  </div>
</div>

<!-- 프로젝터 설정 모달 -->
<div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">프로젝터 설정</h5>
        <button type="button" class="close" onclick="closeSettingsModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="settingsForm">
          <input type="hidden" id="projectorId">
          <div class="form-group">
            <label for="editProjectorName">이름 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="editProjectorName" required placeholder="예: 회의실1 프로젝터, 강당 빔프로젝터">
            <small class="form-text text-muted">
              <i class="fas fa-info-circle mr-1"></i>구분하기 쉬운 이름을 입력하세요 (장소나 용도 포함 권장)
            </small>
          </div>
          <div class="form-group">
            <label for="editProjectorIp">IP 주소 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="editProjectorIp" required pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" placeholder="예: 192.168.1.100">
            <small class="form-text text-muted">
              <i class="fas fa-network-wired mr-1"></i>프로젝터의 네트워크 IP 주소를 입력하세요
            </small>
          </div>
          <div class="form-group">
            <label for="editProjectorModel">모델</label>
            <select class="form-control" id="editProjectorModel">
              <option value="PJLINK">PJLink 표준 (권장)</option>
              <option value="EPSON">Epson</option>
              <option value="PANASONIC">Panasonic</option>
              <option value="SONY">Sony</option>
              <option value="NEC">NEC</option>
              <option value="BENQ">BenQ</option>
              <option value="OPTOMA">Optoma</option>
              <option value="CANON">Canon</option>
              <option value="LG">LG</option>
              <option value="SAMSUNG">Samsung</option>
              <option value="EFUN">EFUN</option>
              <option value="OTHER">기타</option>
            </select>
            <small class="form-text text-muted">
              <i class="fas fa-star mr-1"></i><strong>권장:</strong> "PJLink 표준"은 모든 주요 제조사에서 동일하게 작동합니다
            </small>
          </div>
          <div class="form-group">
            <label for="editProjectorUsername">사용자 ID</label>
            <input type="text" class="form-control" id="editProjectorUsername" value="admin" placeholder="기본값: admin">
            <small class="form-text text-muted">
              <i class="fas fa-user mr-1"></i>대부분의 프로젝터는 기본값 "admin"을 사용합니다
            </small>
          </div>
          <div class="form-group">
            <label for="editProjectorPassword">비밀번호</label>
            <input type="password" class="form-control" id="editProjectorPassword" placeholder="변경하지 않으려면 비워두세요">
            <small class="form-text text-muted">
              <i class="fas fa-lock mr-1"></i><strong>선택사항:</strong> 변경하지 않으려면 비워두세요
              <br><i class="fas fa-edit mr-1"></i>새 비밀번호를 설정하려면 입력하세요
            </small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">취소</button>
        <button type="button" class="btn btn-primary" onclick="updateProjector()">저장</button>
      </div>
    </div>
  </div>
</div>

  <script>
// 전역 함수 정의
let loadProjectorList;

document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM Content Loaded - 페이지 초기화 시작');
  
  try {
    // 문서 제목 설정
    document.title = "프로젝터 관리 - RCS 컨트롤 시스템";
    
    // 웹뷰 상단 메시지 숨기기
    hideWebViewHeader();
    
    // 현재 시간 표시 시작
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    
    // 스케줄 활성화 체크박스 이벤트 리스너 등록
    const scheduleActiveCheckbox = document.getElementById('schedule-active');
    if (scheduleActiveCheckbox) {
      scheduleActiveCheckbox.addEventListener('change', function() {
        console.log('스케줄 활성화 체크박스 변경됨:', this.checked);
        toggleScheduleActive();
      });
      console.log('스케줄 활성화 체크박스 이벤트 리스너 등록 완료');
    } else {
      console.warn('스케줄 활성화 체크박스를 찾을 수 없습니다.');
    }
    
    console.log('초기화 처리 완료');
  } catch (error) {
    console.error('초기화 처리 중 오류:', error);
  }
  
  // 프로젝터 목록 로드 함수 정의
  loadProjectorList = async function() {
    try {
      // 로딩 표시
      const loadingSpinner = document.getElementById('pcSpinner');
      if (loadingSpinner) {
        loadingSpinner.style.display = 'flex';
      }

      // API 호출
      const response = await fetch('/api/projector/list');
      const data = await response.json();

      // API 응답 구조 로깅
      console.log('API 응답 데이터:', data);

      if (!data.success) {
        console.error('프로젝터 목록 로드 실패:', data.message || '알 수 없는 오류');
        document.getElementById('projector-list').innerHTML = '<tr><td colspan="7" class="text-center">프로젝터 목록을 불러올 수 없습니다</td></tr>';
        return;
      }

      // devices 배열에서 프로젝터 목록 추출
      const projectorList = data.devices || [];
      console.log('프로젝터 목록 로드 성공:', projectorList);

      if (!Array.isArray(projectorList) || projectorList.length === 0) {
        document.getElementById('projector-list').innerHTML = '<tr><td colspan="7" class="text-center">등록된 프로젝터가 없습니다</td></tr>';
        return;
      }

      // 프로젝터 목록 렌더링
      let html = '';
      projectorList.forEach((projector, index) => {
        // 네트워크 상태 처리
        const isControlWorking = projector.status === 'on' || projector.status === 'warming' || projector.status === 'cooling';
        const networkStatus = (projector.network_status === 'online' || isControlWorking) ? 'online' : 'offline';
        const networkStatusClass = networkStatus === 'online' ? 'text-success' : 'text-danger';
        const networkStatusText = networkStatus === 'online' ? '연결됨' : '끊김';

        // 전원 상태 처리
        let statusClass = 'text-danger';
        let statusText = '꺼짐';
        
        // 네트워크 상태가 online이거나 제어가 가능한 경우 실제 장비 상태 표시
        if (networkStatus === 'online') {
          switch(projector.status) {
            case 'online':
              statusClass = 'text-success';
              statusText = '작동중';
              break;
            case 'warming':
              statusClass = 'text-warning';
              statusText = '작동중';
              break;
            case 'cooling':
              statusClass = 'text-warning';
              statusText = '작동중';
              break;
          }
        }

        html += `
          <tr data-projector-id="${projector.id}">
            <td>${index + 1}</td>
            <td>${projector.name}</td>
            <td>${projector.ip}</td>
            <td><span class="${networkStatusClass}"><i class="fas fa-circle mr-1"></i>${networkStatusText}</span></td>
            <td><span class="${statusClass}"><i class="fas fa-circle mr-1"></i>${statusText}</span></td>
            <td>
              <div class="control-buttons">
                <button class="btn control-btn btn-success" onclick="controlProjector('${projector.ip}', 'power_on')">
                  <i class="fas fa-power-off"></i> 켜기
                </button>
                <button class="btn control-btn btn-danger" onclick="controlProjector('${projector.ip}', 'power_off')">
                  <i class="fas fa-power-off"></i> 끄기
                </button>
              </div>
            </td>
            <td>
              <div class="settings-buttons">
                <button class="btn control-btn btn-info" onclick="openProjectorSettings('${projector.id}')">
                  <i class="fas fa-cog"></i> 설정
                </button>
                <button class="btn control-btn btn-secondary" onclick="deleteProjector('${projector.id}')">
                  <i class="fas fa-trash-alt"></i> 삭제
                </button>
              </div>
            </td>
          </tr>
        `;
      });

      document.getElementById('projector-list').innerHTML = html;

    } catch (error) {
      console.error('프로젝터 목록 로드 중 오류 발생:', error);
      document.getElementById('projector-list').innerHTML = '<tr><td colspan="7" class="text-center">프로젝터 목록을 불러오는 중 오류가 발생했습니다</td></tr>';
    } finally {
      // 로딩 표시 숨기기
      const loadingSpinner = document.getElementById('pcSpinner');
      if (loadingSpinner) {
        loadingSpinner.style.display = 'none';
      }
    }
  };

  // 스케줄 로드
  loadSchedule();
  
  // 프로젝터 목록 로드
  loadProjectorList();
  
  // 프로젝터 자동 상태 체크
  setTimeout(checkAllProjectorsStatus, 1000);
  
  // 자동 상태 확인 (30초마다)
  setInterval(checkAllProjectorsStatus, 30000);
  
  // 20초마다 프로젝터 목록 자동 새로고침
  setInterval(loadProjectorList, 20000);
  
  try {
    // 프로젝터 추가 버튼 클릭 이벤트 설정
    document.querySelector('.btn-add-projector').addEventListener('click', function(e) {
      e.preventDefault();
      console.log('프로젝터 추가 버튼 클릭');
      
      // jQuery 의존성 제거하고 순수 JavaScript로 모달 표시
      var modal = document.getElementById('addProjectorModal');
      if(modal) {
        modal.classList.add('show');
        document.body.classList.add('modal-open');
        console.log('모달이 표시됨');
        
        // 모달 내부 입력 필드 포커스
        setTimeout(function() {
          var nameField = document.getElementById('projectorName');
          if(nameField) nameField.focus();
        }, 100);
      } else {
        console.error('모달 요소를 찾을 수 없습니다.');
      }
    });
    
    console.log('모달 초기화 성공');
  } catch (error) {
    console.error('초기화 중 오류 발생:', error);
  }
});

// 프로젝터 추가 함수
async function addProjector() {
  try {
    // 입력값 가져오기
    const name = document.getElementById('projectorName').value.trim();
    const ip = document.getElementById('projectorIp').value.trim();
    const type = document.getElementById('projectorModel').value;
    const userId = document.getElementById('projectorUsername').value.trim();
    const password = document.getElementById('projectorPassword').value;
    
    // 유효성 검사
    if (!name) {
      showToast('프로젝터 이름을 입력해주세요.', 'warning');
      document.getElementById('projectorName').focus();
      return;
    }
    
    if (!ip) {
      showToast('IP 주소를 입력해주세요.', 'warning');
      document.getElementById('projectorIp').focus();
      return;
    }
    
    // IP 형식 검사
    const ipPattern = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
    if (!ipPattern.test(ip)) {
      showToast('유효한 IP 주소 형식이 아닙니다. (예: 192.168.0.1)', 'warning');
      document.getElementById('projectorIp').focus();
      return;
    }
    
    // 로딩 표시
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'flex';
    }

    // 데이터 객체 생성
    const projectorData = {
      name: name,
      ip: ip,
      type: type,
      userId: userId || 'admin',
      password: password
    };
    
    console.log('클라이언트 요청 데이터:', projectorData);
    
    // API 호출
    const response = await fetch('/api/projector/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(projectorData)
    });
    
    const data = await response.json();
    console.log('프로젝터 추가 응답:', data); // 응답 데이터 로깅 추가
    
    if (data.success) {
      showToast('프로젝터가 성공적으로 추가되었습니다.', 'success');
      closeAddProjectorModal();
      
      // 약간의 지연 후 목록 새로고침
      setTimeout(async () => {
        await loadProjectorList();
      }, 500);
    } else {
      showToast('프로젝터 추가 실패: ' + (data.message || '알 수 없는 오류'), 'error');
    }
  } catch (error) {
    console.error('API 오류:', error);
    showToast('프로젝터 추가 중 오류가 발생했습니다.', 'error');
  } finally {
    // 로딩 표시 숨기기
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'none';
    }
  }
}

// 프로젝터 설정 모달 닫기
function closeAddProjectorModal() {
  var modal = document.getElementById('addProjectorModal');
  if (modal) {
    modal.classList.remove('show');
    document.body.classList.remove('modal-open');
    console.log('모달이 닫힘');
  }
}

/**
 * 스케줄 설정 저장
 */
async function saveSchedule() {
  try {
    // 로딩 표시
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'flex';
    }
    
    // 스케줄 데이터 수집
    const startTime = document.getElementById('start-time').value || '08:00';
    const endTime = document.getElementById('end-time').value || '18:00';
    
    // 요일 체크박스 값 수집
    const dayCheckboxes = document.querySelectorAll('.day-checkbox');
    const selectedDays = [];
    
    dayCheckboxes.forEach(checkbox => {
      if (checkbox.checked) {
        selectedDays.push(checkbox.value);
      }
    });
    
    // 활성화 상태 체크
    const checkbox = document.getElementById('schedule-active');
    const isActive = checkbox ? checkbox.checked : false;
    
    console.log('활성화 체크박스 상태:', isActive, '체크박스 존재:', !!checkbox);
    
    // API 요청 데이터 구성
    const scheduleData = {
      power_on_time: startTime,
      power_off_time: endTime,
      start_time: startTime,
      end_time: endTime,
      days: selectedDays.join(','),
      is_active: isActive ? 1 : 0
    };
    
    console.log('저장할 스케줄 데이터:', scheduleData);
    
    // API 호출
    const response = await fetch('/api/projector/schedule', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(scheduleData)
    });
    
    const data = await response.json();
        
    if (data.success) {
      showToast('프로젝터 스케줄이 성공적으로 저장되었습니다.', 'success');
    } else {
      showToast('프로젝터 스케줄 저장에 실패했습니다: ' + (data.message || '알 수 없는 오류'), 'error');
    }
  } catch (error) {
    console.error('스케줄 저장 중 오류 발생:', error);
    showToast('스케줄 저장 중 오류가 발생했습니다.', 'error');
  } finally {
    // 로딩 표시 숨기기
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'none';
    }
  }
}

/**
 * 현재 설정된 스케줄 가져오기
 */
async function loadSchedule() {
  try {
    console.log('프로젝터 스케줄 로드 시작');
    
    // API 호출
    const response = await fetch('/api/projector/schedule');
    
    if (!response.ok) {
      console.warn('프로젝터 스케줄 API 응답 실패:', response.status);
      return;
    }
    
    const data = await response.json();
    console.log('프로젝터 스케줄 API 응답:', data);
    
    if (!data.success || !data.schedule) {
      console.warn('프로젝터 스케줄 로드 실패 또는 스케줄 없음');
      return;
    }
    
    const schedule = data.schedule;
    console.log('프로젝터 스케줄 데이터:', schedule);
    
    // 시간 설정
    document.getElementById('start-time').value = schedule.power_on_time || '08:00';
    document.getElementById('end-time').value = schedule.power_off_time || '18:00';
    
    // 요일 설정
    const days = schedule.days ? schedule.days.split(',').map(d => parseInt(d, 10)) : [1, 2, 3, 4, 5];
    const dayCheckboxes = document.querySelectorAll('.day-checkbox');
    
    dayCheckboxes.forEach(checkbox => {
      checkbox.checked = days.includes(parseInt(checkbox.value, 10));
    });
    
    // 활성화 상태 설정 - API에서 받은 실제 값으로 설정
    console.log('서버에서 받은 is_active 원본 값:', schedule.is_active, '타입:', typeof schedule.is_active);
    const isActive = schedule.is_active === 1 || schedule.is_active === '1' || schedule.is_active === true || schedule.is_active === 'true';
    console.log('변환된 활성화 상태:', isActive);
    
    const checkbox = document.getElementById('schedule-active');
    if (checkbox) {
      checkbox.checked = isActive;
      console.log('체크박스 상태 설정 완료:', checkbox.checked);
    } else {
      console.error('schedule-active 체크박스를 찾을 수 없습니다.');
    }
    
    console.log('프로젝터 스케줄 로드 완료 - 활성화 상태:', isActive);
    
  } catch (error) {
    console.error('프로젝터 스케줄 로드 중 오류 발생:', error);
  }
}

/**
 * 스케줄 활성화 상태 즉시 토글
 */
async function toggleScheduleActive() {
  try {
    const isActive = document.getElementById('schedule-active').checked;
    
    console.log('스케줄 활성화 상태 변경 시도:', isActive);
    
    // 로딩 표시
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'flex';
    }
    
    // API 호출하여 스케줄 활성화 상태만 변경
    const response = await fetch('/api/projector/schedule/toggle', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        is_active: isActive
      })
    });
    
    const data = await response.json();
    console.log('스케줄 토글 API 응답:', data);
    
    if (data.success) {
      console.log(`프로젝터 스케줄이 ${isActive ? '활성화' : '비활성화'}되었습니다.`);
      alert(`프로젝터 스케줄이 ${isActive ? '활성화' : '비활성화'}되었습니다.`);
    } else {
      // 스케줄이 없는 경우 기본 스케줄을 생성
      if (data.error && data.error.includes('변경할 스케줄이 없습니다')) {
        console.log('스케줄이 없음. 기본 스케줄을 생성합니다.');
        
        // 현재 화면의 값들을 수집
        const startTime = document.getElementById('start-time').value || '08:00';
        const endTime = document.getElementById('end-time').value || '18:00';
        
        // 요일 체크박스 값 수집
        const dayCheckboxes = document.querySelectorAll('.day-checkbox');
        const selectedDays = [];
        
        dayCheckboxes.forEach(checkbox => {
          if (checkbox.checked) {
            selectedDays.push(checkbox.value);
          }
        });
        
        // 요일이 선택되지 않은 경우 기본값 (월~금)
        if (selectedDays.length === 0) {
          selectedDays.push('1', '2', '3', '4', '5');
        }
        
        // 기본 스케줄 생성
        const scheduleData = {
          power_on_time: startTime,
          power_off_time: endTime,
          start_time: startTime,
          end_time: endTime,
          days: selectedDays.join(','),
          is_active: isActive ? 1 : 0
        };
        
        console.log('기본 스케줄 생성 데이터:', scheduleData);
        
        // 스케줄 생성 API 호출
        const createResponse = await fetch('/api/projector/schedule', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(scheduleData)
        });
        
        const createData = await createResponse.json();
        console.log('스케줄 생성 API 응답:', createData);
        
        if (createData.success) {
          alert(`프로젝터 스케줄이 생성되고 ${isActive ? '활성화' : '비활성화'}되었습니다.`);
        } else {
          throw new Error('스케줄 생성에 실패했습니다: ' + (createData.error || '알 수 없는 오류'));
        }
      } else {
        console.error('스케줄 활성화 상태 변경 실패:', data.error || data.message);
        alert('스케줄 활성화 상태 변경에 실패했습니다: ' + (data.error || data.message || '알 수 없는 오류'));
        // 실패 시 체크박스 상태 원복
        document.getElementById('schedule-active').checked = !isActive;
      }
    }
  } catch (error) {
    console.error('스케줄 활성화 상태 변경 중 오류:', error);
    alert('스케줄 활성화 상태 변경 중 오류가 발생했습니다: ' + error.message);
    
    // 오류 시 체크박스 상태 원복
    const checkbox = document.getElementById('schedule-active');
    if (checkbox) {
      checkbox.checked = !checkbox.checked;
    }
  } finally {
    // 로딩 표시 숨기기
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'none';
    }
  }
}

/**
 * 프로젝터 삭제 함수
 * @param {number} projectorId - 삭제할 프로젝터의 ID
 */
async function deleteProjector(projectorId) {
  try {
    // 삭제 확인
    showConfirm('정말로 이 프로젝터를 삭제하시겠습니까?', async () => {
      // 로딩 표시
      const loadingSpinner = document.getElementById('pcSpinner');
      if (loadingSpinner) {
        loadingSpinner.style.display = 'flex';
      }

      try {
        // API 호출
        const response = await fetch(`/api/projector/${projectorId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const data = await response.json();
        console.log('프로젝터 삭제 응답:', data);

        if (data.success) {
          showToast('프로젝터가 성공적으로 삭제되었습니다.', 'success');
          
          // 프로젝터 목록 새로고침
          await loadProjectorList();
        } else {
          showToast('프로젝터 삭제 실패: ' + (data.message || '알 수 없는 오류'), 'error');
        }
      } catch (error) {
        console.error('프로젝터 삭제 중 오류 발생:', error);
        showToast('프로젝터 삭제 중 오류가 발생했습니다.', 'error');
      } finally {
        // 로딩 표시 숨기기
        const loadingSpinner = document.getElementById('pcSpinner');
        if (loadingSpinner) {
          loadingSpinner.style.display = 'none';
        }
      }
    });
  } catch (error) {
    console.error('프로젝터 삭제 함수 오류:', error);
    showToast('프로젝터 삭제 중 오류가 발생했습니다.', 'error');
  }
}

/**
 * 프로젝터 설정 편집 모달 열기
 * @param {number} projectorId - 편집할 프로젝터의 ID
 */
async function openProjectorSettings(id) {
  try {
    console.log('프로젝터 설정 열기 시작:', id);
    
    // 프로젝터 데이터 로드 - API 엔드포인트 수정
    const response = await fetch(`/api/projector/status/${id}`);
    
    // 응답 텍스트 먼저 확인
    const responseText = await response.text();
    console.log('서버 응답:', responseText);
    
    let data;
    try {
      data = JSON.parse(responseText);
    } catch (e) {
      console.error('JSON 파싱 오류:', e);
      throw new Error('서버 응답을 파싱할 수 없습니다.');
    }
    
    console.log('프로젝터 정보 로드 성공:', data);
    
    if (!data.success || !data.projector) {
      throw new Error('프로젝터 정보를 찾을 수 없습니다.');
    }
    
    // 프로젝터 정보
    const projector = data.projector;
    
    // ID 설정
    document.getElementById('projectorId').value = id;
    
    // 기본 필드 설정
    document.getElementById('editProjectorName').value = projector.name || '';
    document.getElementById('editProjectorIp').value = projector.ip || '';
    
    // extra 데이터 파싱
    let extraData = {};
    try {
      if (projector.extra) {
        if (typeof projector.extra === 'string') {
          extraData = JSON.parse(projector.extra);
        } else if (typeof projector.extra === 'object') {
          extraData = projector.extra;
        }
      }
    } catch (e) {
      console.warn('extra 데이터 파싱 오류:', e);
    }
    
    // 모델 선택
    const modelSelect = document.getElementById('editProjectorModel');
    if (modelSelect) {
      if (extraData.model) {
        // 옵션 중에 일치하는 항목이 있는지 확인
        let found = false;
        for (let i = 0; i < modelSelect.options.length; i++) {
          if (modelSelect.options[i].value === extraData.model) {
            modelSelect.selectedIndex = i;
            found = true;
            break;
          }
        }
        
        // 일치하는 항목이 없으면 기타로 설정
        if (!found) {
          for (let i = 0; i < modelSelect.options.length; i++) {
            if (modelSelect.options[i].value === 'OTHER') {
              modelSelect.selectedIndex = i;
              break;
            }
          }
        }
      }
    }
    
    // 사용자명 설정
    document.getElementById('editProjectorUsername').value = extraData.username || 'admin';
    
    // 비밀번호는 비워둡니다 - 수정하지 않을 경우 기존 비밀번호 유지
    document.getElementById('editProjectorPassword').value = '';
    
    // 모달 열기
    if (typeof $ !== 'undefined' && typeof $.fn.modal !== 'undefined') {
      $('#settingsModal').modal('show');
    } else {
      const modal = document.getElementById('settingsModal');
      if (modal) {
        modal.style.display = 'block';
        modal.classList.add('show');
        document.body.classList.add('modal-open');
        
        // 백드롭 추가
        let backdrop = document.querySelector('.modal-backdrop');
        if (!backdrop) {
          backdrop = document.createElement('div');
          backdrop.className = 'modal-backdrop fade show';
          document.body.appendChild(backdrop);
        }
      }
    }
    
    console.log('프로젝터 설정 모달 열기 완료');
  } catch (error) {
    console.error('프로젝터 설정 열기 중 오류:', error);
    showToast('프로젝터 설정을 불러올 수 없습니다: ' + error.message, 'error');
    
    // 모달 닫기
    closeSettingsModal();
  }
}

/**
 * 프로젝터 정보 업데이트
 * @param {number} projectorId - 업데이트할 프로젝터의 ID
 */
async function updateProjector() {
  try {
    // ID 가져오기
    const projectorId = document.getElementById('projectorId').value;
    if (!projectorId) {
      throw new Error('프로젝터 ID를 찾을 수 없습니다.');
    }

    // 입력값 가져오기
    const name = document.getElementById('editProjectorName').value.trim();
    const ip = document.getElementById('editProjectorIp').value.trim();
    const type = document.getElementById('editProjectorModel').value;
    const userId = document.getElementById('editProjectorUsername').value.trim();
    const password = document.getElementById('editProjectorPassword').value;

    // 유효성 검사
    if (!name) {
      showToast('프로젝터 이름을 입력해주세요.', 'warning');
      document.getElementById('editProjectorName').focus();
      return;
    }

    if (!ip) {
      showToast('IP 주소를 입력해주세요.', 'warning');
      document.getElementById('editProjectorIp').focus();
      return;
    }

    // IP 형식 검사
    const ipPattern = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
    if (!ipPattern.test(ip)) {
      showToast('유효한 IP 주소 형식이 아닙니다. (예: 192.168.0.1)', 'warning');
      document.getElementById('editProjectorIp').focus();
      return;
    }

    // 로딩 표시
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'flex';
    }

    // 업데이트할 데이터 객체
    const projectorData = {
      id: projectorId,
      name: name,
      ip: ip,
      type: type,
      extra: JSON.stringify({
        model: type,
        username: userId || 'admin'
      })
    };

    // 비밀번호가 입력된 경우에만 포함
    if (password) {
      projectorData.password = password;
    }

    console.log('업데이트 요청 데이터:', projectorData);

    // API 호출
    const response = await fetch(`/api/projector/update/${projectorId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(projectorData)
    });

    // 응답 텍스트 먼저 확인
    const responseText = await response.text();
    console.log('서버 응답:', responseText);

    let data;
    try {
      data = JSON.parse(responseText);
    } catch (e) {
      console.error('JSON 파싱 오류:', e);
      throw new Error('서버 응답을 파싱할 수 없습니다.');
    }

    if (data.success) {
      showToast('프로젝터 정보가 성공적으로 업데이트되었습니다.', 'success');
      closeSettingsModal();
      await loadProjectorList();
    } else {
      throw new Error(data.message || '알 수 없는 오류가 발생했습니다.');
    }
  } catch (error) {
    console.error('프로젝터 정보 업데이트 중 오류 발생:', error);
    showToast('프로젝터 정보를 업데이트하는 중 오류가 발생했습니다: ' + error.message, 'error');
  } finally {
    // 로딩 표시 숨기기
    const loadingSpinner = document.getElementById('pcSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'none';
    }
  }
}

// 프로젝터 설정 모달 닫기
function closeSettingsModal() {
  var modal = document.getElementById('settingsModal');
  if (modal) {
    modal.classList.remove('show');
    document.body.classList.remove('modal-open');
    console.log('모달이 닫힘');
  }
}

/**
 * 프로젝터 제어 함수
 * @param {string} ip - 제어할 프로젝터의 IP
 * @param {string} command - 수행할 동작 ('power_on' 또는 'power_off')
 */
async function controlProjector(ip, command) {
  try {
    // API 호출
    const response = await fetch('/api/projector/command', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        ip: ip,
        command: command
      })
    });
    
    if (!response.ok) {
      throw new Error(`서버 오류: ${response.status}`);
    }
    
    const result = await response.json();
    
    if (result.success) {
      console.log('명령 실행 성공:', result);
      const commandText = command === 'power_on' ? '켜기' : '끄기';
      showToast(`프로젝터 ${commandText} 명령이 실행되었습니다.`, 'success');
      // 1초 후 상태 다시 확인 
      setTimeout(loadProjectorList, 1000);
    } else {
      console.error('명령 실행 실패:', result);
      showToast('명령 실행 실패: ' + (result.error || '알 수 없는 오류'), 'error');
    }
  } catch (error) {
    console.error('명령 실행 중 오류:', error);
    showToast('명령 실행 중 오류 발생: ' + error.message, 'error');
  }
}

// 프로젝터 네트워크 상태 확인
async function checkNetworkStatus(id) {
  try {
    const response = await fetch(`/api/projector/check-network/${id}`);
    if (!response.ok) {
      throw new Error(`서버 오류: ${response.status}`);
    }
    
    const result = await response.json();
    
    // 상태 업데이트 처리
    updateProjectorStatus(id, result);
    
    return result;
  } catch (error) {
    console.error('네트워크 상태 확인 중 오류:', error);
    return { success: false, error: error.message };
  }
}

// 프로젝터 상태 업데이트
function updateProjectorStatus(id, result) {
  try {
    const row = document.querySelector(`tr[data-id="${id}"]`);
    if (!row) return;
    
    const networkBadge = row.querySelector('td:nth-child(5) .badge');
    const powerBadge = row.querySelector('td:nth-child(6) .badge');
    
    if (networkBadge) {
      // 하나라도 온라인 상태이면 연결됨으로 표시
      if (result.success && (result.online || result.network_status === 'online' || result.status === 'online' || result.status === 'warming' || result.status === 'cooling')) {
        networkBadge.className = 'badge badge-online';
        networkBadge.textContent = '연결됨';
      } else {
        networkBadge.className = 'badge badge-offline';
        networkBadge.textContent = '끊김';
      }
    }
    
    if (powerBadge) {
      // 장비 상태 업데이트 (PJLink 응답 처리)
      if (result.power_status === 'on' || result.power_status === '1') {
        powerBadge.className = 'badge badge-online';
        powerBadge.textContent = '켜짐';
      } else if (result.power_status === 'warming' || result.power_status === '3') {
        powerBadge.className = 'badge badge-warning';
        powerBadge.textContent = '예열중';
      } else if (result.power_status === 'cooling' || result.power_status === '2') {
        powerBadge.className = 'badge badge-warning';
        powerBadge.textContent = '냉각중';
      } else {
        powerBadge.className = 'badge badge-offline';
        powerBadge.textContent = '꺼짐';
      }
      
      // 장비 상태도 확인하여 업데이트
      if (result.status === 'online') {
        powerBadge.className = 'badge badge-online';
        powerBadge.textContent = '켜짐';
      } else if (result.status === 'warming') {
        powerBadge.className = 'badge badge-warning';
        powerBadge.textContent = '예열중';
      } else if (result.status === 'cooling') {
        powerBadge.className = 'badge badge-warning';
        powerBadge.textContent = '냉각중';
      }
    }
  } catch (error) {
    console.error('상태 업데이트 중 오류:', error);
  }
}

// 모든 프로젝터 상태 확인
async function checkAllProjectorsStatus() {
  try {
    console.log('모든 프로젝터 상태 확인 시작');
    // 프로젝터 목록 가져오기
    const response = await fetch('/api/projector/list');
    const data = await response.json();
    
    if (!data.success || !data.devices) {
      console.error('프로젝터 목록을 가져오는데 실패했습니다.');
      return;
    }
    
    // 각 프로젝터 상태 확인
    for (const projector of data.devices) {
      if (projector.id) {
        await checkNetworkStatus(projector.id);
        // 연속 요청 방지를 위한 지연
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }
    console.log('모든 프로젝터 상태 확인 완료');
  } catch (error) {
    console.error('프로젝터 상태 확인 오류:', error);
  }
}

// 현재 시간 업데이트 (네비게이션 바용)
function updateCurrentTime() {
  const now = new Date();
  
  // 년.월.요일 부분
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
  const weekday = weekdays[now.getDay()];
  
  // 12시간 표시 시간 부분
  let hours = now.getHours();
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  const ampm = hours >= 12 ? '오후' : '오전';
  
  // 12시간제로 변환
  hours = hours % 12;
  hours = hours ? hours : 12; // 0시는 12시로 표시
  hours = String(hours).padStart(2, '0');
  
  const timeString = `${year}.${month}.${weekday} ${ampm} ${hours}:${minutes}:${seconds}`;
  
  const timeElement = document.getElementById('current-time');
  if (timeElement) {
    timeElement.textContent = timeString;
  }
}

// 토스트 메시지 표시 함수 추가
function showToast(message, type = 'info') {
  // 기존 토스트 제거
  const existingToasts = document.querySelectorAll('.toast-message');
  existingToasts.forEach(toast => toast.remove());
  
  // 토스트 컨테이너 확인 및 생성
  let toastContainer = document.querySelector('.toast-container');
  if (!toastContainer) {
    toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container';
    document.body.appendChild(toastContainer);
  }
  
  // 토스트 메시지 생성
  const toast = document.createElement('div');
  toast.className = `toast-message toast-${type}`;
  toast.textContent = message;
  
  // 토스트 추가
  toastContainer.appendChild(toast);
  
  // 애니메이션 효과
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
  }, 10);
  
  // 자동 제거
  setTimeout(() => {
    toast.classList.add('hiding');
    setTimeout(() => {
      if (toast.parentNode) {
        toast.parentNode.removeChild(toast);
      }
    }, 500);
  }, 3000);
}

// 확인 대화상자 함수 추가
function showConfirm(message, onConfirm, onCancel) {
  // 기존 확인 모달 제거
  const existingModal = document.querySelector('.confirm-modal');
  if (existingModal) {
    existingModal.remove();
  }
  
  // 모달 HTML 생성
  const modalHtml = `
    <div class="modal confirm-modal show" style="display: block;">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">확인</h5>
          </div>
          <div class="modal-body">
            <p>${message}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary confirm-cancel">취소</button>
            <button type="button" class="btn btn-primary confirm-ok">확인</button>
          </div>
        </div>
      </div>
    </div>
  `;
  
  // 모달을 DOM에 추가
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  const modal = document.querySelector('.confirm-modal');
  const okBtn = modal.querySelector('.confirm-ok');
  const cancelBtn = modal.querySelector('.confirm-cancel');
  
  // 이벤트 리스너 추가
  okBtn.addEventListener('click', () => {
    modal.remove();
    if (onConfirm) onConfirm();
  });
  
  cancelBtn.addEventListener('click', () => {
    modal.remove();
    if (onCancel) onCancel();
  });
  
  // 백그라운드 클릭으로 닫기
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.remove();
      if (onCancel) onCancel();
    }
  });
}
  </script>
</body>
</html>
