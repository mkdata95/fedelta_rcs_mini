<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>설정 - RCS 컨트롤 시스템</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <!-- 폰트어썸 아이콘 프리로드 -->
  <link rel="preload" href="assets/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="assets/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
  <!-- 로컬 CSS 파일 -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/fontawesome.min.css">
  <link rel="stylesheet" href="assets/css/adminlte.min.css">
  <link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="assets/css/icons.css">
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="assets/css/components.css">
  <link rel="stylesheet" href="assets/css/pc.css">
  <!-- jQuery 및 JavaScript 파일 -->
  <script src="assets/js/jquery-3.6.0.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/common.js"></script>
  <!-- 자바스크립트 파일 -->
  <script>
    // 웹뷰 메시지 완전히 제거하기 위한 즉시 실행 스크립트
    (function() {
      // 웹뷰 상단 메시지 제거를 위한 스타일 즉시 적용
      var style = document.createElement('style');
      style.textContent = `
        /* 웹뷰 헤더 강제 제거 */
        body::before, 
        body::after, 
        body > *:not(.wrapper):not(script):not(style):not(.js-modal):not(.js-notification):not(.modal):not(.modal-backdrop),
        body > div:not(.wrapper):not(.js-modal):not(.js-notification):not(.modal):not(.modal-backdrop),
        #app-header, .app-header, #status-bar, .status-bar, #title-bar, .title-bar,
        #server-status, .server-status,
        div[style*="position: fixed"][style*="top: 0"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="position:fixed"][style*="top:0"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="background-color"][style*="fixed"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="z-index: 9"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop),
        div[style*="z-index:9"]:not(.js-modal):not(.js-modal-dialog):not(.js-notification):not(.modal):not(.modal-backdrop) {
          display: none !important;
          height: 0 !important;
          visibility: hidden !important;
          opacity: 0 !important;
          position: absolute !important;
          z-index: -9999 !important;
        }
        
        /* 문서와 콘텐츠 상단 여백 제거 */
        html, body, .wrapper {
          margin-top: 0 !important;
          padding-top: 0 !important;
        }
        
        /* 모달은 제외할 수 있도록 추가 */
        .modal {
          display: none;
        }
        .modal.show {
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
          z-index: 1050 !important;
        }
      `;
      document.head.appendChild(style);
    })();

    // 문서 로드 시 타이틀 강제 변경
    document.addEventListener('DOMContentLoaded', function() {
      document.title = "설정 - RCS 컨트롤 시스템";
    });
  </script>
  <style>
    /* 카드, 스케줄 카드, 목록 카드 어두운 배경 및 통일 스타일 */
    .card,
    .settings-card {
      background: #191c24 !important;
      border: none !important;
      border-radius: 5px !important;
      box-shadow: 0 0 10px rgba(0,0,0,0.2) !important;
      color: #e9ecef !important;
    }
    .card-header, .settings-card .card-header {
      background: #191c24 !important;
      border-bottom: 1px solid #2c2e33 !important;
      color: #e9ecef !important;
    }
    .card-title {
      color: #e9ecef !important;
    }

    /* 폼 컨트롤 스타일 */
    .form-control {
      background-color: #2A3038 !important;
      border: 1px solid #2c2e33 !important;
      color: #e9ecef !important;
    }

    .form-control:focus {
      background-color: #2A3038 !important;
      border-color: #86b7fe !important;
      color: #e9ecef !important;
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    /* 룸 설정 카드 스타일 */
    .room-card {
      background: #2A3038 !important;
      border: 1px solid #2c2e33 !important;
      border-radius: 8px !important;
      margin-bottom: 15px;
      padding: 15px;
    }

    .room-card .form-group label {
      color: #e9ecef !important;
      font-weight: 500;
    }

    /* 버튼 스타일 */
    .btn-primary {
      background-color: #0d6efd;
      border-color: #0d6efd;
    }

    .btn-primary:hover {
      background-color: #0b5ed7;
      border-color: #0a58ca;
    }

    .btn-success {
      background-color: #28a745;
      border-color: #28a745;
    }

    .btn-success:hover {
      background-color: #218838;
      border-color: #1e7e34;
    }

    /* 로딩 스피너 스타일 */
    .loading-spinner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10000;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 네비게이션 바 시간 표시 스타일 */
    #current-time {
      background: none !important;
      border: none !important;
      box-shadow: none !important;
      padding: 0 !important;
      margin: 0 !important;
    }
  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
  <!-- 네비게이션 바 -->
  <nav class="main-header navbar navbar-expand navbar-dark" style="background-color: #191c24 !important; border-bottom: 1px solid #2c2e33;">
    <!-- 좌측 네비게이션 링크 -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <span class="nav-link font-weight-bold">SMART RCS</span>
      </li>
    </ul>

    <!-- 우측 네비게이션 링크 -->
    <ul class="navbar-nav ml-auto">
      <div id="current-time" class="mr-3 mt-2 text-white" style="font-size: 1.1rem; font-weight: 600; font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif; letter-spacing: 0.5px; line-height: 1.3;"></div>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- 메인 사이드바 -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4" style="background-color: #191c24; box-shadow: 0 0 10px rgba(0,0,0,0.2);">
    <!-- 브랜드 로고 -->
    <a href="index.html" class="brand-link" style="background-color: #191c24; border-bottom: 1px solid #2c2e33;">
      <span class="brand-text font-weight-bold ml-3" style="color: #e9ecef;">RCS CONTROL</span>
    </a>

    <!-- 사이드바 -->
    <div class="sidebar" style="background-color: #191c24;">
      <!-- 사이드바 메뉴 -->
      <nav class="mt-3">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('dashboard.html')" class="nav-link" id="dashboard-link">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                대시보드
              </p>
            </a>
          </li>
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('projector.html')" class="nav-link" id="projector-link">
              <i class="nav-icon fas fa-projector"></i>
              <p>
                빔프로젝터관리
              </p>
            </a>
          </li>
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('pc.html')" class="nav-link" id="pc-link">
              <i class="nav-icon fas fa-desktop"></i>
              <p>
                PC관리
              </p>
            </a>
          </li>
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('pdu.html')" class="nav-link" id="pdu-link">
              <i class="nav-icon fas fa-plug"></i>
              <p>
                PDU관리
              </p>
            </a>
          </li>
          <!-- 그룹원격제어 메뉴 숨김 -->
          <!--
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('group-control.html')" class="nav-link" id="group-control-link">
              <i class="nav-icon fas fa-users"></i>
              <p>
                그룹원격제어
              </p>
            </a>
          </li>
          -->
          <!-- 설정 메뉴 숨김 -->
          <!--
          <li class="nav-item mb-2">
            <a href="javascript:void(0);" onclick="navigateToPage('settings.html')" class="nav-link active" id="settings-link">
              <i class="nav-icon fas fa-cog"></i>
              <p>
                설정
              </p>
            </a>
          </li>
          -->
        </ul>
      </nav>
    </div>
  </aside>

  <!-- 메인 콘텐츠 -->
  <div class="content-wrapper" style="background-color: #0c1427; padding-top: 70px; margin-left: 260px; overflow-x: hidden;">
    <!-- 콘텐츠 헤더 (페이지 헤더) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">설정</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="dashboard.html">홈</a></li>
              <li class="breadcrumb-item active">설정</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <section class="content">
      <div class="container-fluid">
        <!-- 룸 설정 패널 -->
        <div class="card settings-card">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="fas fa-home mr-2" style="color: #0090e7;"></i>룸 설정
            </h4>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="room-count">룸 개수</label>
                  <select class="form-control" id="room-count" onchange="updateRoomSettings()">
                    <option value="1">1개</option>
                    <option value="2">2개</option>
                    <option value="3">3개</option>
                    <option value="4" selected>4개</option>
                    <option value="5">5개</option>
                    <option value="6">6개</option>
                    <option value="7">7개</option>
                    <option value="8">8개</option>
                    <option value="9">9개</option>
                    <option value="10">10개</option>
                    <option value="11">11개</option>
                    <option value="12">12개</option>
                    <option value="13">13개</option>
                    <option value="14">14개</option>
                    <option value="15">15개</option>
                    <option value="16">16개</option>
                    <option value="17">17개</option>
                    <option value="18">18개</option>
                    <option value="19">19개</option>
                    <option value="20">20개</option>
                    <option value="21">21개</option>
                    <option value="22">22개</option>
                    <option value="23">23개</option>
                    <option value="24">24개</option>
                    <option value="25">25개</option>
                    <option value="26">26개</option>
                    <option value="27">27개</option>
                    <option value="28">28개</option>
                    <option value="29">29개</option>
                    <option value="30">30개</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>&nbsp;</label>
                  <div>
                    <button type="button" class="btn btn-success" onclick="saveRoomSettings()">
                      <i class="fas fa-save mr-1"></i> 설정 저장
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 룸별 이름 설정 -->
        <div class="card settings-card">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="fas fa-edit mr-2" style="color: #0090e7;"></i>룸 이름 설정
            </h4>
          </div>
          <div class="card-body">
            <div id="room-name-settings">
              <!-- 룸 이름 설정 카드들이 여기에 동적으로 추가됩니다 -->
            </div>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer d-flex justify-content-between align-items-center" style="background-color: #191c24; border-top: 1px solid #2c2e33; color: #6c757d;">
    <div>
      <strong>Copyright © 2025 <a href="#" style="color: #0090e7;">FEDELTA SMART RCS</a>.</strong> All rights reserved.
    </div>
    <div class="d-flex align-items-center">
      <span class="mr-4" title="서버 상태">
        <span class="status-indicator online" id="server-status-indicator"></span>
        <span class="server-status-text">서버 정상</span>
      </span>
      <span title="네트워크 상태">
        <span class="status-indicator online" id="network-status-indicator"></span>
        <span class="network-status-text">네트워크 정상</span>
      </span>
    </div>
  </footer>
</div>
<!-- ./wrapper -->

<!-- 로딩 스피너 -->
<div id="settingsSpinner" class="loading-spinner">
  <div class="spinner"></div>
  <p>로딩 중...</p>
</div>

<!-- 스크립트 -->
<script>
// 설정 페이지 관련 스크립트

/**
 * 룸 설정 업데이트
 */
function updateRoomSettings() {
  const roomCount = parseInt(document.getElementById('room-count').value);
  const roomNameSettings = document.getElementById('room-name-settings');
  
  // 기존 룸 이름 설정 카드들 제거
  roomNameSettings.innerHTML = '';
  
  // 선택된 룸 개수만큼 룸 이름 설정 카드 생성
  for (let i = 1; i <= roomCount; i++) {
    const roomCard = document.createElement('div');
    roomCard.className = 'room-card';
    roomCard.innerHTML = `
      <div class="form-group mb-0">
        <label for="room-name-${i}">ROOM ${i} 이름</label>
        <input type="text" class="form-control" id="room-name-${i}" value="ROOM ${i}" placeholder="룸 이름을 입력하세요">
      </div>
    `;
    roomNameSettings.appendChild(roomCard);
  }
}

/**
 * 룸 설정 저장
 */
async function saveRoomSettings() {
  try {
    // 로딩 표시
    document.getElementById('settingsSpinner').style.display = 'flex';
    
    const roomCount = parseInt(document.getElementById('room-count').value);
    const roomNames = [];
    
    // 각 룸의 이름 수집
    for (let i = 1; i <= roomCount; i++) {
      const roomNameInput = document.getElementById(`room-name-${i}`);
      if (roomNameInput) {
        roomNames.push({
          id: i,
          name: roomNameInput.value.trim() || `ROOM ${i}`
        });
      }
    }
    
    // 설정 데이터 구성
    const settingsData = {
      room_count: roomCount,
      room_names: roomNames
    };
    
    console.log('저장할 설정 데이터:', settingsData);
    
    // 서버 API 호출
    const response = await fetch('/api/settings/rooms', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(settingsData)
    });
    
    const data = await response.json();
    
    if (data.success) {
      alert('룸 설정이 성공적으로 저장되었습니다.');
    } else {
      alert('룸 설정 저장에 실패했습니다: ' + (data.message || '알 수 없는 오류'));
    }
    
  } catch (error) {
    console.error('룸 설정 저장 중 오류 발생:', error);
    alert('룸 설정 저장 중 오류가 발생했습니다.');
  } finally {
    // 로딩 표시 숨기기
    document.getElementById('settingsSpinner').style.display = 'none';
  }
}

/**
 * 저장된 룸 설정 로드
 */
async function loadRoomSettings() {
  try {
    // 서버에서 설정 로드
    const response = await fetch('/api/settings/rooms');
    
    if (response.ok) {
      const result = await response.json();
      
      if (result.success && result.data) {
        const settings = result.data;
        
        // 룸 개수 설정
        document.getElementById('room-count').value = settings.room_count || 4;
        
        // 룸 이름 설정 업데이트
        updateRoomSettings();
        
        // 저장된 룸 이름들 적용
        if (settings.room_names) {
          settings.room_names.forEach(room => {
            const roomNameInput = document.getElementById(`room-name-${room.id}`);
            if (roomNameInput) {
              roomNameInput.value = room.name;
            }
          });
        }
        
        console.log('룸 설정 로드 완료:', settings);
      } else {
        console.log('서버에서 기본 설정 사용');
        updateRoomSettings();
      }
    } else {
      console.log('설정 로드 실패, 기본 설정 사용');
      updateRoomSettings();
    }
  } catch (error) {
    console.error('룸 설정 로드 중 오류 발생:', error);
    // 오류 시 기본 설정으로 초기화
    updateRoomSettings();
  }
}

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
  console.log('설정 페이지 초기화 시작');
  
  // 저장된 룸 설정 로드
  loadRoomSettings();
  
  // 현재 시간 표시 시작
  updateCurrentTime();
  setInterval(updateCurrentTime, 1000);
  
  console.log('설정 페이지 초기화 완료');
});

// 현재 시간 업데이트 (네비게이션 바용)
function updateCurrentTime() {
  const now = new Date();
  
  // 년.월.요일 부분
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
  const weekday = weekdays[now.getDay()];
  
  // 12시간 표시 시간 부분
  let hours = now.getHours();
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  const ampm = hours >= 12 ? '오후' : '오전';
  
  // 12시간제로 변환
  hours = hours % 12;
  hours = hours ? hours : 12; // 0시는 12시로 표시
  hours = String(hours).padStart(2, '0');
  
  const timeString = `${year}.${month}.${weekday} ${ampm} ${hours}:${minutes}:${seconds}`;
  
  const timeElement = document.getElementById('current-time');
  if (timeElement) {
    timeElement.textContent = timeString;
  }
}
</script>
</body>
</html> 